---
title: "My_Titanic"
author: "Clement Mugenzi"
date: "9/20/2019"
output: github_document
---

This dataset will be comprised of two separate .csv files, both of which will be combined then used to predict who survives on the titanic.
But first, let's load all packages that I will be using in this project.

```{r setup, include=F}
library(tidyverse)
library(ggthemes)
library(scales)
library(mice)
library(randomForest)
```


# Import the Dataset

```{r, results='asis', include=T}
# First, we will load the train dataset.
train = read_csv("train.csv")
# Second, the test dataset is loaded
test = read_csv("test.csv")
# Then both the train and test datasets are combined into a single dataset.
full = bind_rows(train, test)
```

# Feature Engineering

```{r, include=F}
# Grab title from passenger's name.
full$Title <- gsub('(.*,) | (\\..*)', '', full$Name)
# Show title counts by sex
table(pull(full, Sex), pull(full, Title))
```

Titles with very low cell counts to be combined to "rare" level in the chunk below.

```{r, include=T}
rare_title <- c("Dona", "Lady", "the Countess",
                "Capt", "Col", "Don", "Dr",
                "Major", "Rev", "Sir", "Jonkheer")
# Also reassign mlle, ms, and mme accordingly
full$Title[full$Title == "Mlle"] = "Miss"
full$Title[full$Title == "Ms"] = "Miss"
full$Title[full$Title == "Mme"] = "Mrs"
full$Title[full$Title %in% rare_title] = "rare_title"
```
Show title counts by sex again
```{r, include=F}
# Show title counts by sex again
table(full$Sex, full$Title)
full$Surname <- sapply(full$Name,function(x) strsplit(x, split = '[,.]')[[1]][1])
cat(paste('We have <b>', nlevels(factor(full$Surname))))
## Do families sink or swim together?
# Create a family size variabke including the passenger themselves
full$fsize <- full$SibSp + full$Parch + 1
# Create a family variable
full$family <- paste(full$Surname, full$fsize, sep = '_')
```

# Visualization

```{r, include=TRUE}
# Use ggplot2 to visualize the relationship between family size and survival
ggplot(full[1:891,], aes(x = fsize, fill = factor(Survived))) +
  geom_bar(star = 'Count', position = 'dodge') + scale_x_continuous(breaks = c(1:11)) + labs(x ='Family Size') + theme_few()
```


```{r, include=TRUE}
# Let's Discretize family size
full$fsizeD[full$fsize == 1] <- 'Singleton'
full$fsizeD[full$fsize < 5 & full$fsize > 1] <- 'Small'
full$fsizeD[full$fsize > 4] <- 'Large'
# Show family size by survival using mosaic plot
mosaicplot(table(full$fsizeD, full$Survived), main = 'Family size by survival', shade = T)
```




































